---
title: "Predicting .. from Spotify Music"
author: Alyssia Goodwin & Nolan Guzman & Arthur Diaz
date: "May 3, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<<<<<<< Updated upstream
#Data Input and Preprocessing 

=======
## Intro

We are using the "Now That's What I Call Music(U.S. releases)" data set from Kaggle to predict the danceability of a song. Danceability is described with how much a song will get people todance from the tempo, rhythm stability, beat, and regulatiry. The scale of danceability ranges from 0 to 1, 0 being the least danceable while 1 is the most danceable song. 



## Preprocessing 

Looking at the data there does not seem to be any null data within the database. From looking at the database it deo

```{r}
library(rpart)
library(rpart.plot)
library(maptree)
library(e1071)
library(cluster)

# the following utility files can be found attached to the assignment
source("https://raw.githubusercontent.com/grbruns/cst383/master/lin-regr-util.R")
source("https://raw.githubusercontent.com/grbruns/cst383/master/class-util.R")

dat=read.csv("data.csv")

sum(is.null(dat))
dat$X = NULL
dat$loudness=abs(dat$loudness)
dat$song_title = NULL
dat$instrumentalness = NULL

dat$danceability=dat$danceability*100
dat$energy=dat$energy*100
dat$acousticness=dat$acousticness*100
dat$liveness=dat$liveness*100
dat$valence=dat$valence*100
dat$speechiness=dat$speechiness*100

```

#Data Exploration

```{r}
dat$song_title=NULL
summary(dat)
```


```{r,echo=TRUE}

plot(dat$tempo ~ dat$speechiness)
plot(dat)

plot(dat$energy~dat$loudness)
plot(dat$acousticness~dat$loudness)
plot(density(dat$energy))
```

```{r, echo=TRUE}
fit=lm(danceability ~ acousticness+energy+liveness+loudness+speechiness+valence, data=dat)

summary(fit)

par(mfrow=c(2,2))
plot(density(dat$danceability),col="red",main="Density of Features")
lines(density(dat$energy),col="green")
lines(density(dat$liveness),col="blue")

legend("topright",legend=c("Dance","Energy","Liveness"),col=c("Red","Green","Blue"),lty=1,cex=.7)

plot(ecdf(dat$danceability),col="red",main="ECDF of Features")
lines(ecdf(dat$energy),col="green")
lines(ecdf(dat$liveness),col="blue")
legend("bottomright",legend=c("Dance","Energy","Liveness"),col=c("Red","Green","Blue"),lty=1,cex=.7)

plot(danceability ~ energy, data=dat, col="red",main="Danceability by Speechiness")
plot(danceability ~ liveness, data=dat, col="red",main="Danceability by Liveness")

```

```{r,echo=TRUE}
split = split_data(dat)
tr_dat = split[[1]]
te_dat = split[[2]]

fit=lm(danceability ~ energy+liveness, data=tr_dat)
predicts=predict(fit, te_dat)
actual=te_dat$danceability


plot(actual ~ predicts, pch=20, main="Predicted Danceablity Vs. Actual",col="red")
abline(fit,col="black",lty=2)

```

```{r, echo=TRUE}
par(mfrow=c(2,2))
plot(fit)
summary(fit)
mse=mean((actual-predicts)^2)
rmse=sqrt(mse)
rmse
```

```{r, echo=TRUE}

te_dat$artist=NULL
te_dat$key=NULL
te_dat$mode=NULL
te_dat$target=NULL
te_dat$time_signature=NULL
te_dat$duration_ms=NULL
te_dat$tempo=NULL

par(mfrow=c(1,2))
hc=hclust(dist(te_dat),method="complete")
clusters=cutree(hc,10)
cols=rainbow(10)[clusters]
plot(danceability ~ energy,data=te_dat,col=cols,pch=16,main="Danceability by Energy, n=10")
plot(danceability ~ liveness,data=te_dat,col=cols,pch=16,main="Danceability by Liveness, n=10")

fit=kmeans(te_dat,10)
cat("Betweenss of fit: ",fit$betweenss)
cat("\nTotss of fit: ",fit$totss)
fit$betweenss/fit$totss

sil=silhouette(fit$cluster,dist(te_dat))
mean(sil[,3])

hc=hclust(dist(te_dat),method="complete")
clusters=cutree(hc,100)
cols=rainbow(100)[clusters]
plot(danceability ~ energy,data=te_dat,col=cols,pch=16,main="Danceability by Energy, n=100")
plot(danceability ~ liveness,data=te_dat,col=cols,pch=16,main="Danceability by Liveness, n=100")

fit2=kmeans(te_dat,100)

cat("\nBetweenss of fit: ",fit$betweenss)
cat("\nTotss of fit: ",fit$totss)
fit2$betweenss/fit2$totss

sil2=silhouette(fit2$cluster,dist(te_dat))
mean(sil2[,3])

```

```{r}
fit = rpart(danceability ~ energy +liveness, data = tr_dat)
prp(fit, extra=1, varlen=-10, main="Regression Tree for Danceability (tr_dat)",box.col= "green")

fit2 = rpart(danceability ~ energy +liveness, data = te_dat)
prp(fit2, extra=1, varlen=-10, main="Regression Tree for Danceability (te_dat)",box.col= "green")
```

```{r}
predicted = predict(fit, te_dat)
errors = te_dat$danceability - predicted
rmse = sqrt(mean(errors^2))
plot_predict_actual(predicted, actual, 2, "Regression Tree Danceablility Prediction")
```

```{r}
hist(errors, col = "red4", main = "Histogram of Errors, Regression Tree")
```